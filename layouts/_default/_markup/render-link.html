{{- $attrs := dict }}
{{- $u := urls.Parse .Destination }}

{{- if $u.IsAbs }}
  {{- /* Remote */}}
  {{- $attrs = dict "href" $u.String "rel" "external" }}
  {{- else }}
    {{- with $u.Path }}
      {{- with $.Page.GetPage . }}
        {{- /* Page */}}
        {{- $href := .RelPermalink }}
        {{- with $u.RawQuery }}
          {{- $href = printf "%s?%s" $href $u.RawQuery }}
        {{- end }}
        {{- with $u.Fragment }}
          {{- $href = printf "%s#%s" $href $u.Fragment }}
        {{- end }}
        {{- $attrs = dict "href" $href }}
      {{- end }}
  {{- end }}
{{- end }}

{{- with .Title }}
  {{- $attrs = merge $attrs (dict "title" .) }}
{{- end -}}

<a
{{- range $k, $v := $attrs }}
  {{- printf " %s=%q" $k $v | safeHTMLAttr }}
{{- end -}}
>{{ .Text | safe.HTML }}</a>
{{- /**/ -}}